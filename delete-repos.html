<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>GitHub ä»“åº“æ‰¹é‡åˆ é™¤å·¥å…·</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; background: #f9f9f9; }
    input, button { padding: 8px; margin: 5px 0; width: 100%; }
    .repo-list { max-height: 300px; overflow-y: auto; background: #fff; border: 1px solid #ccc; padding: 10px; }
    .repo-item { margin-bottom: 5px; }
    .danger { color: red; font-weight: bold; }
    details { background: #eef; padding: 10px; border-radius: 5px; margin-top: 10px; }
    summary { font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>
  <h2>ğŸ§¹ GitHub ä»“åº“æ‰¹é‡åˆ é™¤å·¥å…·</h2>
  <p>âœ… æœ¬å·¥å…·å®Œå…¨åœ¨ä½ çš„æµè§ˆå™¨æœ¬åœ°è¿è¡Œï¼Œ<strong>ä¸ä¼šä¸Šä¼ ä»»ä½•æ•°æ®</strong>ï¼Œæ”¾å¿ƒä½¿ç”¨ã€‚</p>

  <label>ğŸ‘¤ GitHub ç”¨æˆ·åï¼š</label>
  <input type="text" id="username" placeholder="ä¾‹å¦‚ï¼šHupan">
  <label>ğŸ”‘ GitHub Tokenï¼š</label>
  <input type="password" id="token" placeholder="ç²˜è´´ä½ çš„ GitHub Token">
  <button onclick="fetchRepos()">è·å–ä»“åº“åˆ—è¡¨</button>

  <div class="repo-list" id="repoList"></div>

  <button class="danger" onclick="deleteSelected()">ğŸš¨ åˆ é™¤é€‰ä¸­ä»“åº“</button>

  <details>
    <summary>ğŸ“˜ å¦‚ä½•è·å–æ­£ç¡®çš„ GitHub Tokenï¼Ÿï¼ˆç‚¹å‡»å±•å¼€æ•™ç¨‹ï¼‰</summary>
    <ol>
      <li>è®¿é—® <a href="https://github.com/settings/tokens" target="_blank">https://github.com/settings/tokens</a></li>
      <li>ç‚¹å‡»å³ä¸Šè§’ <strong>Generate new token (classic)</strong></li>
      <li>å¡«å†™åå­—ï¼Œå»ºè®®æœ‰æ•ˆæœŸè®¾ä¸º <strong>1 å¤©</strong></li>
      <li>å‹¾é€‰æƒé™ï¼š<strong>repo</strong> å’Œ <strong>delete_repo</strong></li>
      <li>ç‚¹å‡»ç”Ÿæˆï¼Œå¤åˆ¶ç”Ÿæˆçš„ Token ç²˜è´´åˆ°æœ¬é¡µé¢ä½¿ç”¨</li>
    </ol>
    <p>ğŸ” è¿™æ˜¯ä½ åˆ é™¤ä»“åº“çš„â€œé’¥åŒ™â€ï¼Œè¯·å¦¥å–„ä¿ç®¡ï¼Œä½¿ç”¨åå»ºè®®åˆ é™¤è¯¥ Tokenã€‚</p>
  </details>

  <script>
    let repos = [];

    async function fetchRepos() {
      const username = document.getElementById("username").value;
      const token = document.getElementById("token").value;
      if (!username || !token) return alert("è¯·è¾“å…¥ç”¨æˆ·åå’Œ Token");

      repos = [];
      let page = 1;
      document.getElementById("repoList").innerHTML = "ğŸ”„ åŠ è½½ä¸­...";

      while (true) {
        const res = await fetch(`https://api.github.com/user/repos?per_page=100&page=${page}`, {
          headers: { Authorization: `token ${token}` }
        });
        const data = await res.json();
        if (!Array.isArray(data) || data.length === 0) break;
        repos = repos.concat(data);
        page++;
      }

      let html = repos.map((repo, i) => `
        <div class="repo-item">
          <input type="checkbox" id="repo${i}" checked>
          <label for="repo${i}">${repo.full_name}</label>
        </div>`).join("");

      document.getElementById("repoList").innerHTML = `<p>å…± ${repos.length} ä¸ªä»“åº“ï¼š</p>` + html;
    }

    async function deleteSelected() {
      const token = document.getElementById("token").value;
      const confirmDelete = confirm("ä½ ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ä»“åº“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼");
      if (!confirmDelete) return;

      for (let i = 0; i < repos.length; i++) {
        const checkbox = document.getElementById("repo" + i);
        if (checkbox && checkbox.checked) {
          const delRes = await fetch(`https://api.github.com/repos/${repos[i].full_name}`, {
            method: "DELETE",
            headers: { Authorization: `token ${token}` }
          });
          if (delRes.status === 204) {
            checkbox.parentElement.innerHTML += " âœ… åˆ é™¤æˆåŠŸ";
          } else {
            checkbox.parentElement.innerHTML += ` âŒ åˆ é™¤å¤±è´¥ï¼ˆçŠ¶æ€ç  ${delRes.status}ï¼‰`;
          }
        }
      }
    }
  </script>
</body>
</html>
